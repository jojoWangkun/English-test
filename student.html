<!DOCTYPE html>
<meta charset="utf-8">
<title>é€‰æ‹©é¢˜åº“ | è‹±è¯­ç­”é¢˜ç³»ç»Ÿ</title>
<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Microsoft YaHei', Arial, sans-serif;
  }
  body {
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    min-height: 100vh;
    padding: 20px;
  }
  .container {
    max-width: 500px;
    width: 100%;
    margin: 30px auto;
    background: white;
    border-radius: 20px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.1);
    padding: 30px;
  }
  h1 {
    color: #2c3e50;
    margin-bottom: 25px;
    font-size: 24px;
    font-weight: 600;
    text-align: center;
  }
  .form-group {
    margin-bottom: 20px;
  }
  label {
    display: block;
    margin-bottom: 8px;
    color: #34495e;
    font-weight: 500;
    font-size: 16px;
  }
  input {
    width: 100%;
    padding: 14px 16px;
    border: 1px solid #e1e8ed;
    border-radius: 10px;
    font-size: 16px;
    transition: border 0.3s ease;
  }
  input:focus {
    outline: none;
    border-color: #4CAF50;
    box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
  }
  .file-list {
    margin-top: 20px;
  }
  .loading, .empty {
    text-align: center;
    padding: 30px;
    color: #7f8c8d;
    font-size: 16px;
  }
  .loading {
    color: #3498db;
  }
  .file-btn {
    width: 100%;
    padding: 16px;
    margin: 8px 0;
    font-size: 16px;
    border: none;
    border-radius: 10px;
    color: white;
    cursor: pointer;
    background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
    box-shadow: 0 4px 12px rgba(52, 152, 219, 0.2);
    transition: all 0.3s ease;
  }
  .file-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 15px rgba(52, 152, 219, 0.3);
  }
  .back-btn {
    display: inline-block;
    margin-top: 20px;
    color: #3498db;
    text-decoration: none;
    font-size: 15px;
  }
</style>
<div class="container">
  <h1>âœï¸ å¼€å§‹ç­”é¢˜</h1>
  <div class="form-group">
    <label for="userName">è¯·è¾“å…¥ä½ çš„å§“å</label>
    <input type="text" id="userName" placeholder="ä¾‹å¦‚ï¼šå¼ ä¸‰" required>
  </div>
  <div class="file-list" id="fileList">
    <div class="loading">ğŸ”„ æ­£åœ¨åŠ è½½é¢˜åº“...</div>
  </div>
  <a href="index.html" class="back-btn">â† è¿”å›é¦–é¡µ</a>
</div>

<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script>
const GITHUB_REPO = "jojoWangkun/English-test";
const FOLDER = "questions";

window.onload = loadFileList;

// åŠ è½½é¢˜åº“åˆ—è¡¨
async function loadFileList() {
  const el = document.getElementById('fileList');
  try {
    const response = await fetch(`https://api.github.com/repos/${GITHUB_REPO}/contents/${FOLDER}`);
    if (!response.ok) throw new Error("é¢˜åº“åŠ è½½å¤±è´¥");
    
    const files = await response.json();
    const excelFiles = files.filter(file => file.name.endsWith('.xlsx'));
    
    if (excelFiles.length === 0) {
      el.innerHTML = "<div class='empty'>ğŸ“‚ æš‚æ— å¯ç”¨é¢˜åº“</div>";
      return;
    }
    
    let html = '';
    excelFiles.forEach(file => {
      html += `<button class="file-btn" onclick="startTest('${file.name}')">ğŸ“š ${file.name}</button>`;
    });
    el.innerHTML = html;
  } catch (error) {
    el.innerHTML = `<div class="empty">âŒ åŠ è½½å¤±è´¥ï¼š${error.message}</div>`;
    console.error("é¢˜åº“åŠ è½½é”™è¯¯ï¼š", error);
  }
}

// å¼€å§‹ç­”é¢˜
function startTest(fileName) {
  const userName = document.getElementById('userName').value.trim();
  if (!userName) {
    alert("è¯·å…ˆè¾“å…¥ä½ çš„å§“åï¼");
    return;
  }
  
  // ä¿å­˜ç”¨æˆ·ä¿¡æ¯
  localStorage.setItem('userInfo', JSON.stringify({
    name: userName,
    file: fileName,
    startTime: new Date().getTime() // è®°å½•ç­”é¢˜å¼€å§‹æ—¶é—´
  }));
  
  location.href = 'test.html';
}
</script>
