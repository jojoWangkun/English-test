<!DOCTYPE html>
<meta charset="utf-8">
<title>选择题库</title>
<style>
  body{max-width:500px;margin:50px auto;font-family:Arial;padding:0 20px}
  .form-group{margin:20px 0}
  label{display:block;margin-bottom:8px;font-weight:bold}
  input{width:100%;padding:12px;border:1px solid #ccc;border-radius:8px;font-size:16px;box-sizing:border-box}
  .btn{width:100%;padding:15px;font-size:18px;border:none;border-radius:8px;color:white;background:#4CAF50;margin:5px 0;cursor:pointer}
  .empty{text-align:center;padding:30px;color:#666;border:1px dashed #ccc;border-radius:8px;margin:20px 0}
  .loading{text-align:center;color:#666;margin:20px 0}
</style>
<h1>开始答题</h1>
<div class="form-group">
  <label>姓名</label>
  <input type="text" id="userName" placeholder="输入姓名" required>
</div>
<div id="fileList" class="loading">加载题库中...</div>

<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script>
const GITHUB_REPO = "jojoWangkun/English-test";
const FOLDER = "questions";

window.onload = loadFileList;

async function loadFileList() {
  const el = document.getElementById('fileList');
  try {
    const r = await fetch(`https://api.github.com/repos/${GITHUB_REPO}/contents/${FOLDER}`);
    const files = await r.json();
    const list = files.filter(f => f.name.endsWith('.xlsx'));
    if (list.length === 0) {
      el.innerHTML = "<div class='empty'>暂无题库</div>";
      return;
    }
    let html = '';
    list.forEach(f => {
      html += `<button class="btn" onclick="go('${f.name}')">${f.name}</button>`;
    });
    el.innerHTML = html;
  } catch (e) {
    el.innerHTML = "<div class='empty'>加载失败</div>";
  }
}

function go(file) {
  const name = document.getElementById('userName').value.trim();
  if (!name) { alert('请输入姓名'); return; }
  localStorage.setItem('user', JSON.stringify({ name, file }));
  location.href = 'test.html';
}
</script>
